<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1440, initial-scale=1, user-scalable=no">
  <title>COIN DEFENSE v3.5</title>
  <link rel="stylesheet" as="style" crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
  <!-- 네오둥근모 한글 픽셀 폰트 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/neodgm-webfont@latest/neodgm/style.css" />
  <link rel="stylesheet" href="/src/client/style.css">
  <link rel="stylesheet" href="/src/client/lobby-pro.css">
</head>

<body>
  <div id="game-scale-wrapper">

    <!-- ════════════════════════════════════════════════ -->
    <!-- SCREEN 1: LOBBY                                  -->
    <!-- ════════════════════════════════════════════════ -->
    <div id="lobby-screen" class="screen lobby-screen">
      <div class="lobby-bg-overlay"></div>
      <!-- 우측 상단 유틸리티 버튼 -->
      <div class="lobby-top-right">
        <button class="lobby-util-btn" id="btn-lobby-home">
          🏠
        </button>
        <button class="lobby-util-btn" id="btn-lobby-settings">
          ⚙️
        </button>
      </div>
      <div class="lobby-content">
        <div class="lobby-logo">
          <div class="lobby-logo-icon">⚔️</div>
          <h1 class="lobby-title">COIN DEFENSE</h1>
          <div class="lobby-subtitle">크립토 랜덤디펜스</div>
        </div>

        <div class="lobby-modes" id="lobby-modes">
          <button class="lobby-mode-btn campaign-btn" id="btn-campaign">
            <span class="mode-btn-icon">📖</span>
            <span class="mode-btn-label">캠페인 <span class="mode-btn-sub">《튜토리얼》</span></span>
          </button>
          <button class="lobby-mode-btn normal-btn" id="btn-normal">
            <span class="mode-btn-icon">⚔️</span>
            <span class="mode-btn-label">일반전</span>
          </button>
        </div>

        <!-- 일반전 하위 모드 (숨김 상태) -->
        <div class="lobby-submodes hidden" id="lobby-submodes">
          <div class="submodes-title">모드 선택</div>
          <button class="lobby-submode-btn" id="btn-solo">
            <span class="mode-btn-icon">👤</span>
            <span class="mode-btn-label">싱글 모드</span>
          </button>
          <button class="lobby-submode-btn" id="btn-4player">
            <span class="mode-btn-icon">🌐</span>
            <span class="mode-btn-label">4인 경쟁 모드</span>
          </button>
          <button class="lobby-back-btn" id="btn-back-lobby">← 뒤로</button>
        </div>

        <div class="lobby-version">v3.5 — Pixel Edition</div>
      </div>
    </div>

    <!-- ════════════════════════════════════════════════ -->
    <!-- SCREEN 2: MATCHMAKING                             -->
    <!-- ════════════════════════════════════════════════ -->
    <div id="match-screen" class="screen match-screen hidden">
      <div class="match-bg-overlay"></div>
      <div class="match-content">
        <div class="match-title">⚔️ 실시간 매칭 중...</div>
        <div class="match-status" id="match-status">1/4 대기중...</div>
        <div class="match-players" id="match-players">
          <div class="match-player-slot" id="mp-slot-0">
            <div class="mp-avatar">🎮</div>
            <div class="mp-name">나</div>
            <div class="mp-status ready">✔ 준비됨</div>
          </div>
          <div class="match-player-slot waiting" id="mp-slot-1">
            <div class="mp-avatar">❓</div>
            <div class="mp-name">대기중...</div>
            <div class="mp-status"></div>
          </div>
          <div class="match-player-slot waiting" id="mp-slot-2">
            <div class="mp-avatar">❓</div>
            <div class="mp-name">대기중...</div>
            <div class="mp-status"></div>
          </div>
          <div class="match-player-slot waiting" id="mp-slot-3">
            <div class="mp-avatar">❓</div>
            <div class="mp-name">대기중...</div>
            <div class="mp-status"></div>
          </div>
        </div>
        <div class="match-loading hidden" id="match-loading">
          <div class="match-loading-text">🎮 게임 로딩 중...</div>
          <div class="match-loading-bar">
            <div class="match-loading-fill" id="match-loading-fill"></div>
          </div>
        </div>
        <button class="match-start-btn hidden" id="btn-start-bots">🤖 봇 채우고 이대로 시작하기</button>
        <button class="match-cancel-btn" id="btn-cancel-match">✖ 취소</button>
      </div>
    </div>

    <!-- ════════════════════════════════════════════════ -->
    <!-- SCREEN 3: GAME (기존 #app)                       -->
    <!-- ════════════════════════════════════════════════ -->
    <div id="game-screen" class="screen hidden">

      <!-- PRO Lobby (동적 렌더링 — 기존 호환) -->
      <div id="lobby-pro" class="lobby-pro-root hidden"></div>

      <!-- 결과 화면 -->
      <div id="result-view" class="result-view hidden"></div>

      <div id="app">

        <!-- ═══ Column 1: Bench Sidebar ═══ -->
        <aside id="bench-panel">
          <div class="bench-header">
            <span>📦 벤치</span>
            <span class="bench-count" id="bench-count">0/9</span>
          </div>
          <div id="bench-slots"></div>
        </aside>

        <!-- ═══ Column 2: Main Column ═══ -->
        <div id="main-column">
          <!-- Top HUD Bar -->
          <header id="hud">
            <div class="hud-left">
              <div class="hud-pill">
                <span class="hud-label">ROUND</span>
                <span class="hud-value num" id="hud-round">0</span>
              </div>
              <div class="hud-hp-bar">
                <div class="hud-hp-fill" id="hud-hp-fill" style="width:100%"></div>
                <span class="hud-hp-text">❤️ <span id="hud-hp" class="num">30</span></span>
              </div>
            </div>
            <div class="hud-right">
              <div class="hud-pill gold-pill">
                <span class="hud-gold-icon">💰</span>
                <span class="hud-value num" id="hud-gold">10</span>
              </div>
              <div class="hud-pill">
                <span class="hud-label">DPS</span>
                <span class="hud-value num" id="hud-dps">0</span>
              </div>
              <button id="btn-info" class="hud-icon-btn" title="유닛 정보">📋</button>
              <button id="btn-speed" class="hud-icon-btn speed-btn" title="게임 속도">▶ 1x</button>
              <button id="btn-settings" class="hud-icon-btn" title="설정">⚙️</button>
            </div>
          </header>

          <!-- Board Area -->
          <section id="board-section">
            <div id="map-wrapper">
              <!-- Monster outer path (rectangular loop) -->
              <div id="monster-path">
                <div id="path-start">▶ START</div>
              </div>
              <!-- Board grid (inside the path) -->
              <div id="board-grid"></div>
              <!-- Board count badge -->
              <div id="board-badge">
                <span>🗺️</span>
                <span id="board-count">0/1</span>
              </div>
            </div>
            <!-- 관전 워터마크 -->
            <div id="spectate-watermark" class="spectate-watermark hidden">
              👀 관전 중: <span id="spectate-name">Player 2</span>
            </div>
          </section>

          <!-- Control Bar -->
          <div id="control-bar">
            <div class="cb-left">
              <div class="cb-level">
                <span class="cb-level-label">Lv</span>
                <span class="cb-level-value num" id="hud-level">1</span>
              </div>
              <div class="cb-xp">
                <div class="cb-xp-bar">
                  <div class="cb-xp-fill" id="dock-xp-fill" style="width:0%"></div>
                </div>
                <span class="cb-xp-text num" id="hud-xp">0/2 XP</span>
              </div>
              <button id="btn-buy-xp" class="cb-btn cb-btn-xp">
                📈 XP 구매 <span class="cb-cost">4G</span>
              </button>
              <button id="btn-reroll" class="cb-btn">🔄 리롤 <span class="cb-cost">2G</span></button>
              <button id="btn-lock" class="cb-btn cb-btn-lock">🔒 잠금</button>
            </div>
            <div class="cb-right">
              <button id="btn-next-round" class="cb-btn cb-btn-combat">⚔️ 전투 시작</button>
            </div>
          </div>

          <!-- Shop Card Bar -->
          <div id="shop-bar">
            <div id="sell-zone" class="sell-zone hidden">
              🗑️ 여기에 놓으면 판매 (<span id="sell-zone-price">0</span>G)
            </div>
            <div id="shop-slots" class="shop-card-row"></div>
          </div>
        </div>

        <!-- ═══ Column 3: Right Panel ═══ -->
        <aside id="right-panel">
          <!-- Tab Buttons -->
          <div class="right-tabs">
            <button class="right-tab active" data-tab="synergy-section">🧬 시너지</button>
            <button class="right-tab" data-tab="dps-section">⚔️ DPS</button>
            <button class="right-tab" data-tab="log-panel">📜 로그</button>
          </div>
          <!-- Tab Content -->
          <div class="right-tab-content">
            <div id="synergy-section" class="tab-pane active">
              <div style="font-size:11px;color:#f59e0b;padding:2px 8px;opacity:0.8">⚠️ 직업 시너지: 비활성화 (업데이트 중)</div>
              <div id="synergy-list"></div>
            </div>
            <div id="dps-section" class="tab-pane" style="display:none">
              <div id="dps-list"></div>
            </div>
            <div id="log-panel" class="tab-pane" style="display:none">
              <div id="log-content"></div>
            </div>
          </div>
          <!-- 미니맵: 탭 바깥 하단 고정 -->
          <div id="minimap-panel" class="minimap-panel">
            <div class="panel-title">👥 플레이어</div>
            <div id="minimap-players"></div>
          </div>
        </aside>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>

    <!-- Settings Modal -->
    <div id="settings-overlay" class="settings-overlay hidden">
      <div class="settings-modal">
        <h2>⚙️ 설정</h2>
        <div class="settings-group">
          <button id="settings-restart" class="settings-action-btn danger">🔄 다시 시작</button>
          <button id="settings-pause" class="settings-action-btn">⏸️ 일시정지</button>
        </div>
        <div class="settings-group">
          <label class="settings-label">🔊 효과음</label>
          <input type="range" id="settings-sfx" min="0" max="100" value="80" class="settings-slider">
          <span id="settings-sfx-val">80%</span>
        </div>
        <div class="settings-group">
          <label class="settings-label">🎵 BGM</label>
          <input type="range" id="settings-bgm" min="0" max="100" value="60" class="settings-slider">
          <span id="settings-bgm-val">60%</span>
        </div>
        <button id="settings-close" class="settings-action-btn accent">✖ 닫기</button>
      </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-overlay" class="game-over-overlay hidden">
      <div class="game-over-modal">
        <div class="game-over-header">
          <h1 id="game-over-title" class="game-over-title">💀 GAME OVER</h1>
          <div id="game-over-subtitle" class="game-over-subtitle">체력이 모두 소진되었습니다</div>
        </div>

        <div class="game-over-stats">
          <div class="stat-card">
            <div class="stat-icon">🏁</div>
            <div class="stat-label">최종 라운드</div>
            <div id="stat-final-round" class="stat-value">-</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">💸</div>
            <div class="stat-label">사용한 골드</div>
            <div id="stat-gold-spent" class="stat-value">-</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">💎</div>
            <div class="stat-label">고급 유닛</div>
            <div id="stat-premium-units" class="stat-value">-</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">⚔️</div>
            <div class="stat-label">최종 DPS</div>
            <div id="stat-final-dps" class="stat-value">-</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">🧬</div>
            <div class="stat-label">활성 시너지</div>
            <div id="stat-synergies" class="stat-value">-</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">⏱️</div>
            <div class="stat-label">플레이 시간</div>
            <div id="stat-play-time" class="stat-value">-</div>
          </div>
        </div>

        <div class="game-over-units">
          <div class="units-label">최종 유닛</div>
          <div id="game-over-unit-list" class="unit-list-display"></div>
        </div>

        <button id="btn-game-over-restart" class="game-over-restart-btn">🔄 다시 시작</button>
      </div>
    </div>
  </div><!-- /game-scale-wrapper -->

  <script>
    (function () {
      var W = 1440, H = 810;
      var wr = document.getElementById('game-scale-wrapper');
      function fit() {
        var vw = window.innerWidth, vh = window.innerHeight;
        var s = Math.min(vw / W, vh / H);
        wr.style.transform = 'scale(' + s + ')';
        wr.style.left = ((vw - W * s) / 2) + 'px';
        wr.style.top = ((vh - H * s) / 2) + 'px';
      }
      window.addEventListener('resize', fit);
      window.addEventListener('orientationchange', function () { setTimeout(fit, 100); });
      fit();
    })();
  </script>
</body>

</html>